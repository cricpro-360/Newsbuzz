<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 400px; margin: auto; }
    img { width: 120px; border-radius: 50%; margin-top: 10px; }
  </style>
</head>
<body>

  <h2>Profile Form</h2>
  <form id="profileForm" enctype="multipart/form-data">
    <input type="text" name="phone" placeholder="Phone Number" required><br><br>
    <input type="text" name="username" placeholder="Username" required><br><br>
    <input type="password" name="password" placeholder="Password"><br><br>
    <input type="file" name="profilePic" accept="image/*"><br><br>
    <button type="submit">Save Profile</button>
  </form>

  <hr>

  <h3>Profile Info</h3>
  <div id="profileDisplay"></div>

<script>
  const form = document.getElementById('profileForm');
  const display = document.getElementById('profileDisplay');

  // Submit or update profile
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    const response = await fetch('https://newsbuzz-1.onrender.com/profile', {
      method: 'POST',
      body: formData
    });

    const user = await response.json();

    // Save user ID for future auto loading
    localStorage.setItem('userId', user._id);

    showProfile(user);
  });

  // Load profile by phone number (optional search)
  form.phone.addEventListener('blur', async () => {
    const phone = form.phone.value;
    if (!phone) return;

    const res = await fetch(`https://newsbuzz-1.onrender.com/profile/${phone}`);
    if (!res.ok) return;

    const user = await res.json();

    // Optional: store userId when loading by phone
    localStorage.setItem('userId', user._id);

    form.username.value = user.username || '';
    form.password.value = user.password || '';
    showProfile(user);
  });

  // Auto-load profile using stored userId
  window.addEventListener('DOMContentLoaded', async () => {
    const userId = localStorage.getItem('userId');
    if (!userId) return;

    const res = await fetch(`https://newsbuzz-1.onrender.com/profile/id/${userId}`);
    if (!res.ok) return;

    const user = await res.json();
    form.phone.value = user.phone || '';
    form.username.value = user.username || '';
    form.password.value = user.password || '';
    showProfile(user);
  });

  // Display user profile in UI
  function showProfile(user) {
    display.innerHTML = `
      <strong>Username:</strong> ${user.username}<br>
      <strong>Phone:</strong> ${user.phone}<br>
      ${user.profilePic ? `<img src="${user.profilePic}" alt="Profile Pic">` : ''}
    `;
  }
</script>

</body>
</html>
