<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8">
  <title>ಸ್ಥಳ ಆಯ್ಕೆಮಾಡಿ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .hidden { display: none; }
    label, select { display: block; margin-top: 10px; }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex; justify-content: center; align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%; max-width: 400px;
    }

    #selectBtn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <button id="selectBtn">ಸ್ಥಳ ಆಯ್ಕೆಮಾಡಿ</button>

  <div id="locationModal" class="modal hidden">
    <div class="modal-content">
      <h3>ನಿಮ್ಮ ರಾಜ್ಯ, ಜಿಲ್ಲೆ, ತಾಲ್ಲೂಕು ಆಯ್ಕೆಮಾಡಿ</h3>
      
      <label>ರಾಜ್ಯ:</label>
      <select id="stateSelect">
        <option value="">ರಾಜ್ಯ ಆಯ್ಕೆಮಾಡಿ</option>
      </select>

      <label>ಜಿಲ್ಲೆ:</label>
      <select id="districtSelect" disabled>
        <option value="">ಜಿಲ್ಲೆ ಆಯ್ಕೆಮಾಡಿ</option>
      </select>

      <label>ತಾಲ್ಲೂಕು:</label>
      <select id="talukSelect" disabled>
        <option value="">ತಾಲ್ಲೂಕು ಆಯ್ಕೆಮಾಡಿ</option>
      </select>

      <button id="saveLocation" style="margin-top: 15px;">ಸ್ಥಳ Confirm ಮಾಡಿ</button>
    </div>
  </div>

  <div id="output" style="margin-top: 20px;"></div>

  <script>
    const data = {
      Karnataka: {
        Tumakuru: ['Tumakuru', 'Tiptur', 'Kunigal'],
        Mysuru: ['Mysuru', 'Nanjangud', 'Hunsur'],
      },
      Kerala: {
        Ernakulam: ['Kochi', 'Perumbavoor'],
        Kannur: ['Kannur', 'Thalassery'],
      }
    };

    const stateSelect = document.getElementById('stateSelect');
    const districtSelect = document.getElementById('districtSelect');
    const talukSelect = document.getElementById('talukSelect');
    const modal = document.getElementById('locationModal');
    const output = document.getElementById('output');

    // Load States
    Object.keys(data).forEach(state => {
      const option = document.createElement('option');
      option.value = state;
      option.textContent = state;
      stateSelect.appendChild(option);
    });

    // Handle State change
    stateSelect.addEventListener('change', () => {
      const selectedState = stateSelect.value;
      districtSelect.innerHTML = '<option value="">ಜಿಲ್ಲೆ ಆಯ್ಕೆಮಾಡಿ</option>';
      talukSelect.innerHTML = '<option value="">ತಾಲ್ಲೂಕು ಆಯ್ಕೆಮಾಡಿ</option>';
      talukSelect.disabled = true;

      if (selectedState) {
        const districts = Object.keys(data[selectedState]);
        districts.forEach(dist => {
          const option = document.createElement('option');
          option.value = dist;
          option.textContent = dist;
          districtSelect.appendChild(option);
        });
        districtSelect.disabled = false;
      } else {
        districtSelect.disabled = true;
      }
    });

    // Handle District change
    districtSelect.addEventListener('change', () => {
      const state = stateSelect.value;
      const dist = districtSelect.value;
      talukSelect.innerHTML = '<option value="">ತಾಲ್ಲೂಕು ಆಯ್ಕೆಮಾಡಿ</option>';

      if (dist) {
        const taluks = data[state][dist];
        taluks.forEach(tk => {
          const option = document.createElement('option');
          option.value = tk;
          option.textContent = tk;
          talukSelect.appendChild(option);
        });
        talukSelect.disabled = false;
      } else {
        talukSelect.disabled = true;
      }
    });

    // Open modal
    document.getElementById('selectBtn').addEventListener('click', () => {
      modal.classList.remove('hidden');
    });

    // Save location
    document.getElementById('saveLocation').addEventListener('click', () => {
      const state = stateSelect.value;
      const dist = districtSelect.value;
      const taluk = talukSelect.value;

      if (state && dist && taluk) {
        const locationString = `${state} > ${dist} > ${taluk}`;
        localStorage.setItem('userLocationFull', locationString);
        document.getElementById('selectBtn').textContent = `ಸ್ಥಳ: ${taluk}`;
        output.innerHTML = `<strong>ನೀವು ಆಯ್ಕೆ ಮಾಡಿದ ಸ್ಥಳ:</strong><br>${locationString}`;
        modal.classList.add('hidden');
      } else {
        alert("ದಯವಿಟ್ಟು ರಾಜ್ಯ, ಜಿಲ್ಲೆ ಮತ್ತು ತಾಲ್ಲೂಕು ಆಯ್ಕೆಮಾಡಿ.");
      }
    });

    // On page load
    window.onload = () => {
      const saved = localStorage.getItem('userLocationFull');
      if (saved) {
        output.innerHTML = `<strong>ನೀವು ಹಿಂದಿನ ಬಾರಿ ಆಯ್ಕೆ ಮಾಡಿದ ಸ್ಥಳ:</strong><br>${saved}`;
        document.getElementById('selectBtn').textContent = `ಸ್ಥಳ: ${saved.split(' > ')[2]}`;
      }
    };
  </script>

</body>
</html>
